# 作業進捗表

---

## 1. 拡張画面キャプチャ対応

### 問題概要

現状、`ScreenshotOverlay` のオーバーレイが `winfo_screenwidth()` / `winfo_screenheight()` を使用しており、プライマリディスプレイのサイズしか返さないため、拡張ディスプレイ上の範囲を選択・キャプチャできない。

### タスク一覧

| # | タスク | 状態 | 概要 |
|---|--------|------|------|
| 1 | 全ディスプレイのジオメトリ取得 | 完了 | `ctypes` + `user32.dll` の `GetSystemMetrics` で仮想スクリーン情報を取得する `get_virtual_screen_bounds()` を実装 |
| 2 | オーバーレイを全画面に拡張 | 完了 | 仮想スクリーン全体のバウンディングボックスを計算し、オーバーレイが全ディスプレイを覆うように変更 |
| 3 | 座標マッピングの確認 | 完了 | `event.x_root`/`y_root` はスクリーン絶対座標のため追加修正不要 |
| 4 | ImageGrab のキャプチャ修正 | 完了 | `ImageGrab.grab()` に `all_screens=True` を追加（Windows ではこれがないとプライマリのみキャプチャ） |
| 5 | 依存パッケージの確認 | 完了 | 追加パッケージなし（`ctypes` は Python 標準ライブラリ） |
| 6 | ドキュメント更新 | 完了 | README.md / docs にマルチモニター対応・Windows 動作環境を反映 |

### 修正内容まとめ

- 追加パッケージを使わず、Python 標準ライブラリの `ctypes` で Windows の `user32.dll` を直接呼び出す
- macOS（開発環境）では `winfo_screenwidth()` / `winfo_screenheight()` によるフォールバック

---

## 2. プレビュー画面の透明度調整機能

### 概要

プレビュー画面（`PreviewWindow`）上で、マウスのスクロールホイール操作によりウィンドウの透明度をリアルタイムに変更できるようにする。透明度を上げることで、プレビュー画像越しに背面のウィンドウを確認しながら作業できる。複数のプレビュー画面が存在する場合、それぞれ独立して透明度を調整可能。

### 該当箇所

`main.py` — `PreviewWindow.__init__()` 内。現在 `-alpha` は未設定（デフォルト 1.0 = 完全不透明）:

```python
self.window = tk.Toplevel(app.root)
self.window.title("Screenshot Preview")
self.window.resizable(False, False)
```

### タスク一覧

| # | タスク | 状態 | 概要 |
|---|--------|------|------|
| 1 | マウス操作の決定 | 完了 | スクロールホイールで透明度を増減する方式を採用（右クリックメニュー・Ctrl+ドラッグ描画と競合しない） |
| 2 | 透明度変更ロジックの実装 | 完了 | `PreviewWindow` に `<MouseWheel>` イベントをバインドし、`-alpha` 属性をリアルタイムに更新 |
| 3 | 透明度の範囲制限 | 完了 | 0.1（ほぼ透明）〜 1.0（完全不透明）にクランプ、1ノッチあたり 0.05 刻み |
| 4 | ドキュメント更新 | 完了 | README.md の操作早見表・主な機能、docs/modules.md を更新 |

### 備考

- 現在スクロールホイールには何もバインドされていないため、競合なし
- ズーム操作は右クリックメニューから行うため、スクロールとの混同は生じない
- 各 `PreviewWindow` は個別の `tk.Toplevel` なので、透明度は画面ごとに独立して管理される
